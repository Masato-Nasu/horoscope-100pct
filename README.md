出生日（出生地・時刻・タイムゾーン）と、解析日（正午固定）の2つの時点での**黄経（Ecliptic Longitude = 天球上の360°座標）**を求めます。

② アスペクト検出

天体Aと天体Bの角度差 Δ を計算。

③ カテゴリ別スコア化

アスペクトごとに「強度 × アスペクトの重み × 惑星の重要度」を掛け算してスコアに加算。

カテゴリ例： 

総合 … 太陽・月・木星・土星など

恋愛 … 金星・月・火星

仕事 … 太陽・火星・土星

金運 … 木星・金星

健康 … 月・土星・火星

最後にシグモイド関数（1/(1+exp(-x))) を使って0〜100%の範囲に正規化。
→ 「科学的に出した風の数値」になり、安定性も担保されます。

④ 文章生成

カテゴリごとのスコアに応じて「好調 / 普通 / 注意」に分類。 

67%以上 → 好調

34〜66% → 普通

33%以下 → 注意

それぞれのカテゴリ × 状態に対応する文章テンプレート集（TPL）から、 

乱数生成器（ただし日付固定）を使って毎回同じ日付では同じ文章が選ばれる。

同じ日にリロードしても結果は変わらない。

出力は5行ずつ（今回拡張版）、読み物感を出す。

まとめると

**占星術の形式（天体・アスペクト・ハウス的要素）**をベースに、

天文計算は astronomy-engine で正確に、

解釈（文章化）はシステム化されたテンプレ＋確率制御
という「半分本格・半分生成系」のアルゴリズムです。

🌌 基本の角度 = 黄経（Ecliptic Longitude）

天体の位置は「地球中心から見た、黄道面に投影した座標」＝黄経で扱います。

つまり、黄道を基準に 0°〜360° の角度（春分点 = 0° Aries を起点）。

例: 太陽が 90° にあれば「蟹座0°」あたり。

---

🔭 計算しているもの

1. 出生時刻の天体黄経

Sun, Moon, Mercury, Venus, Mars, Jupiter, Saturn, Uranus, Neptune, Pluto

さらに

ASC（Ascendant）: 出生地の東の地平線と黄道の交点

MC（Medium Coeli）: 出生地での天の子午線と黄道の交点（南中点）

2. 解析日（正午固定）の天体黄経

同じく太陽〜冥王星＋ASC＋MC を算出

---

⚖️ アスペクト角度差

出生時の天体黄経 − 当日の天体黄経 = Δ（角度差）
（360°で剰余をとり、0〜180°の最小差に正規化）

Δが以下に近ければ「アスペクト」と判定：

0° ±8° → コンジャンクション

60° ±6° → セクスタイル

90° ±8° → スクエア

120° ±8° → トライン

180° ±8° → オポジション

✨ 具体例

もし出生時の太陽が 20°牡牛座 ( = 50° ) にあり、
今日の太陽が 22°獅子座 ( = 142° ) にあれば：

Δ = |142° − 50°| = 92° ≒ 90°

→ **スクエア（90°±8°に入っている）**として検出されます。

このスクエアは「太陽 vs 太陽」としてスコア計算に寄与。

まとめ

計算している角度は 各天体の黄経（0〜360°）同士の差。

つまり「天球上で、地球から見た惑星の黄道上の見かけの角度差」です。

ハウスや赤緯の要素は入れていないので、シンプルに2次元的な黄道投影角度だけで判定しています。
