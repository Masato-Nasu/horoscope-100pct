# 🌟 100% 星占い

**100% 星占い** は、実際の天体位置（太陽〜土星）をブラウザ内で計算し、  
「生まれたときの配置」と「今日（または指定日）」との相性を  
**0〜100% のパーセンテージ**で表示する占いアプリです。

12星座の一般論ではなく、  
**総合・恋愛・仕事・金運・健康** をそれぞれスコアと短い文章で伝えます。

---

## 🚀 実行ページ

👉 **https://masato-nasu.github.io/horoscope-100pct/**

スマートフォンからアクセスすると、ホーム画面に追加して  
アプリのように使えます（PWA 対応）。

---

## 📸 スクリーンショット

**トップ画面**

<p align="center">
  <img src="docs/screenshot-top.png" alt="トップ画面" width="420">
</p>

**結果画面**

<p align="center">
  <img src="docs/screenshot-result.png" alt="結果画面" width="420">
</p>

---

## 🔮 特長

- **実天体ベースの相性判定**  
  太陽・月・水星・金星・火星・木星・土星の黄経を計算し、  
  「生まれた日の配置」と「占いたい日の配置」の違いから相性度を算出します。

- **100% スコア表示**  
  総合／恋愛／仕事／金運／健康の 5 分野を 0〜100% で表示。  
  ざっくり「今日はどんな日か」を一目で把握できます。

- **文章バンク方式のメッセージ**  
  スコア帯（高め／ふつう／慎重モード）ごとに複数パターンの文章を用意し、  
  同じスコアでもできるだけ違う文章が出るようになっています。

- **日付指定も可能**  
  フォームで好きな日付を指定すると、その日の相性度を計算します。  
  空欄なら「今日」が自動で使われます。

- **PWA 対応**  
  `manifest.json` と `sw.js` により、ホーム画面に追加して  
  ネイティブアプリのように起動できます。

---

## 🧮 天体計算とアルゴリズム

### ライブラリ

天体位置の計算には下記ライブラリを使用しています。

- [Astronomy Engine](https://github.com/cosinekitty/astronomy)  
  （ブラウザ向けビルド `astronomy.browser.min.js`）

ブラウザだけで動作し、太陽・月・惑星の位置を  
実用的な精度で計算できます。

### 1. 天体位置の取得

- 対象天体  
  - Sun, Moon, Mercury, Venus, Mars, Jupiter, Saturn
- 生年月日と占いたい日それぞれについて、正午（ローカル時刻）で  
  各天体の黄道経度（0〜360°）を取得しています。

### 2. 角度差とアスペクト

生まれた日の黄経と、占いたい日の黄経の差（0〜360°）から  
主要アスペクトへの近さを評価します。

- 0°（コンジャンクション）
- 60° / 120°（ソフトアスペクト）
- 90° / 180°（ハードアスペクト）

それぞれに「加点／減点」の重みを持たせ、  
ガウス関数でなめらかにスコア化したものを合計し、  
平均が 0 付近になるようにバイアスを調整しています。

### 3. 分野ごとのスコア生成

正規化されたスコアをもとに、分野ごとに天体の重みを変えて合成します。

- 総合運：木星・土星＋全体のバランス
- 恋愛：金星・月・水星を重視
- 仕事：土星・火星・太陽を重視
- 金運：木星・土星＋金星
- 健康：太陽・月＋木星

長期的な配置（木星・土星など）がマイナス方向に強いときは、  
数字が極端に落ちすぎないように「効き方を少し弱める」補正を入れています。

### 4. 0〜100% への変換

-1〜+1 の指標を、単純な直線ではなく  
**平方根カーブ**で 0〜100% にマッピングしています。

- ふつうの日：40〜80% あたりに収まりやすい  
- 配置が強く響く日：90〜100% に近づく  
- 逆風が強い日：30% 前後まで下がることもある  

ごく一部、特別に配置が強い日は 100% が出るように調整しています。

### 5. テキストの選び方

各分野ごとに

- 高め（A）
- ふつう（B）
- 慎重モード（C）

の 3 段階を設定し、スコア帯に応じて文章バンクからメッセージを選びます。

同じ「誕生日＋占いたい日」の組み合わせでは  
基本的に同じ文章になるよう、日付と誕生日から  
安定した乱数シードを作成しています。

---

## 📱 使い方

1. 生年月日を入力  
2. 必要なら「占いたい日」を入力（空欄なら今日）  
3. ［この日の運勢を見る］ボタンを押す  

総合／恋愛／仕事／金運／健康の 5 項目について、  
0〜100% のスコアと一言メッセージが表示されます。

---

## 📲 PWA として使う

このアプリは PWA（Progressive Web App）に対応しています。

### Android（Chrome）

1. アプリページを Chrome で開く  
2. 右上のメニュー「︙」から［アプリをインストール］を選択  
3. ホーム画面に「100% 星占い」アイコンが追加されます  

### iPhone / iPad（Safari）

1. Safari でページを開く  
2. 画面下の共有ボタン「□↑」→［ホーム画面に追加］を選択  
3. 右上の「追加」を押すと、ホームにアイコンが並びます  

---

## 🧪 技術メモ

- 単一ファイル構成：`index.html`（HTML + CSS + JS）  
- 依存ライブラリ：CDN から `astronomy.browser.min.js` を読み込み  
- PWA 用ファイル：`manifest.json` / `sw.js` / アイコン一式

---

## 📄 ライセンス

- アプリ本体：作者の意図に従ってご利用ください。  
- 天文計算ライブラリ：  
  [Astronomy Engine](https://github.com/cosinekitty/astronomy) のライセンスに従います。
