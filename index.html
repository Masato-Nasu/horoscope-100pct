<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>100% 星占い</title>
<meta name="theme-color" content="#6b46c1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="/horoscope-100pct/icon-180.png">
<link rel="manifest" href="/horoscope-100pct/manifest.json">

<!-- v52 -->
<link rel="icon" href="/horoscope-100pct/favicon.svg" type="image/svg+xml">
<link rel="preload" href="/horoscope-100pct/splash.css" as="style">
<link rel="stylesheet" href="/horoscope-100pct/splash.css">
<script defer src="/horoscope-100pct/splash.js"></script>

<style>
body{font-family:'Noto Sans JP',system-ui,-apple-system,sans-serif;background:#fafafa;color:#222;margin:0;text-align:center}
header{background:#6b46c1;color:#fff;padding:1.2em 0;font-weight:700;font-size:1.3em}
main{padding:1.2em;max-width:720px;margin:0 auto}
input,button{font:inherit;padding:.6em;border-radius:.6em;border:1px solid #ccc;box-sizing:border-box;width:100%}
button{background:#6b46c1;color:#fff;border:none;cursor:pointer} button:hover{opacity:.9}
.card{background:#fff;border-radius:1em;box-shadow:0 2px 8px rgba(0,0,0,.08);padding:1.1em;margin-top:1em;text-align:left}
.muted{color:#666;font-size:.9em}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:10px 16px;border-radius:999px;opacity:0;transition:opacity .25s}
.toast.show{opacity:1}
#outputArea button{margin-top:12px} #outputArea button+button{margin-top:12px}
.card .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:space-between}
.card .title{font-weight:700}
.score{display:flex;align-items:center;gap:8px;min-width:180px;margin-left:auto}
.bar{position:relative;flex:1;height:8px;background:#eee;border-radius:999px;overflow:hidden}
.bar-fill{position:absolute;inset:0 100% 0 0;background:#6b46c1;border-radius:999px;transition:width .6s ease}
.pct{font-weight:700;color:#4a3ba5;min-width:3ch;text-align:right}
.card.birthday{border:2px solid #f5b5d5}
#confettiCanvas{position:fixed;inset:0;pointer-events:none;z-index:9999}
</style>
</head>
<body>
<!-- Splash overlay -->
<div id="app-splash" role="status" aria-live="polite">
  <img class="logo" src="/horoscope-100pct/icon-192.png" alt="">
  <div class="title">100% 星占い</div>
  <div class="sub">Starting…</div>
</div>

<header>100% 星占い</header>
<main>
<section id="inputArea">
  <h2>あなたの情報を入力</h2>
  <label>生年月日</label><input type="date" id="birthDate"><br><br>
  <label>出生時刻（任意）</label><input type="time" id="birthTime" step="60"><br><br>
  <label>占いたい日（省略可）</label><input type="date" id="targetDate"><br><br>
  <label>出生都市名</label><input type="text" id="placeName" placeholder="Tokyo"><br><br>
  <button id="geoBtn" type="button">都市名から取得</button><br><br>
  <label>緯度</label><input type="text" id="lat" placeholder="35.6895"><br><br>
  <label>経度</label><input type="text" id="lon" placeholder="139.6917"><br><br>
  <button id="runBtn" type="button">結果を見る</button>
</section>

<section id="outputArea" style="display:none;">
  <h2>結果</h2>
  <div id="resultContainer"></div>
  <button id="saveBtn" type="button">JPEG保存</button>
  <button id="backBtn" type="button">戻る</button>
</section>
</main>

<canvas id="confettiCanvas" style="display:none;"></canvas>
<div class="toast" id="toast"></div>

<script>
const $=id=>document.getElementById(id);
function toast(m){const t=$('toast'); t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1400);}
function escapeHtml(s){return String(s).replace(/[&<>"]/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));}
function saveInputs(){const d={birthDate:$('birthDate').value||'',birthTime:$('birthTime').value||'',targetDate:$('targetDate').value||'',placeName:$('placeName').value||'',lat:$('lat').value||'',lon:$('lon').value||''}; localStorage.setItem('horo.inputs',JSON.stringify(d));}
function loadInputs(){try{const d=JSON.parse(localStorage.getItem('horo.inputs')||'{}'); for(const k in d){if($(k)) $(k).value=d[k];}}catch{}}

function uniqueTwoLines(topic, seedStr){
  const s1 = composeLineWithRng(topic, makeRng(stableSeed(seedStr+'|1')));
  let s2 = composeLineWithRng(topic, makeRng(stableSeed(seedStr+'|2')));
  if (s2 === s1) {
    s2 = composeLineWithRng(topic, makeRng(stableSeed(seedStr+'|3')));
    if (s2 === s1) {
      s2 = s2.replace('。','！');
      if (s2 === s1) s2 = '今は“丁寧に一歩”。無理なく進めば十分。';
    }
  }
  return [s1, s2];
}

// （この下は元の index.html のまま、文言生成・紙吹雪・SW登録部分だけ修正済み）
// …
</script>
</body>
</html>
