<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>100% æ˜Ÿå ã„ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰</title>
<meta name="theme-color" content="#B79DF2">
<link rel="manifest" href="manifest.json">

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Noto Sans JP", sans-serif;
  background: #ffffff;
  color: #333333;
  margin: 0;
  padding: 16px;
  text-align: center;
}
h1 {
  font-size: 20px;
  margin: 0 0 8px;
  color: #7C4DFF;
}
.lead {
  font-size: 12px;
  color: #777777;
  margin-bottom: 16px;
}
.app-card {
  max-width: 420px;
  margin: 0 auto;
  background: #ffffff;
  border-radius: 18px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  padding: 18px 16px 20px;
}
.app-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 10px;
}
.app-icon {
  font-size: 28px;
}
.app-title-block {
  text-align: left;
}
.app-title {
  font-size: 16px;
  font-weight: 600;
  color: #7C4DFF;
  margin: 0;
}
.app-subtitle {
  font-size: 11px;
  color: #999999;
  margin: 2px 0 0;
}

.form-row {
  margin-bottom: 10px;
  text-align: left;
}
label {
  display: block;
  margin-bottom: 4px;
  font-size: 12px;
  color: #555555;
}
input {
  width: 100%;
  box-sizing: border-box;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid #DDDDFF;
  font-size: 13px;
  font-family: inherit;
}
input:focus {
  outline: none;
  border-color: #B79DF2;
  box-shadow: 0 0 0 1px rgba(183,157,242,0.5);
}

button {
  width: 100%;
  box-sizing: border-box;
  border: none;
  padding: 11px 12px;
  border-radius: 999px;
  margin-top: 14px;
  font-size: 14px;
  font-weight: 600;
  background: linear-gradient(135deg, #B79DF2, #7C4DFF);
  color: #ffffff;
  cursor: pointer;
}
button:active {
  transform: translateY(1px);
  box-shadow: 0 3px 8px rgba(0,0,0,0.2) inset;
}

.note {
  margin-top: 10px;
  font-size: 11px;
  color: #888888;
  line-height: 1.5;
}

.result {
  margin-top: 16px;
  text-align: left;
}

/* ã‚«ãƒ¼ãƒ‰ */
.section-title {
  margin: 18px 0 4px;
  font-size: 14px;
  font-weight: 600;
  color: #7C4DFF;
  display: flex;
  align-items: center;
  gap: 6px;
}
.section-title span.icon {
  font-size: 18px;
}

.percent-line {
  font-size: 14px;
  margin-bottom: 4px;
  font-weight: 600;
}
.percent-line strong {
  font-size: 18px;
  color: #7C4DFF;
}

.text-block {
  font-size: 12px;
  color: #555555;
  line-height: 1.7;
  padding: 8px 10px;
  border-radius: 12px;
  background: #F7F4FF;
  margin-bottom: 6px;
}

/* ã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£ç”¨ã‚­ãƒ£ãƒ³ãƒã‚¹ */
#confettiCanvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9999;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>
</head>
<body>
<canvas id="confettiCanvas"></canvas>

<div class="app-card">
  <div class="app-header">
    <div class="app-icon">ğŸª</div>
    <div class="app-title-block">
      <p class="app-title">100% æ˜Ÿå ã„</p>
      <p class="app-subtitle">å¤ªé™½ã€œåœŸæ˜Ÿã®é…ç½®ã‚’ã‚‚ã¨ã«ã€ä»Šæ—¥ã¨ã®ç›¸æ€§ã‚’æ•°å€¤åŒ–ã—ã¾ã™ã€‚</p>
    </div>
  </div>

  <div class="form-row">
    <label for="birth">ç”Ÿå¹´æœˆæ—¥</label>
    <input id="birth" type="date" value="1978-12-31">
  </div>

  <div class="form-row">
    <label for="targetDate">å ã„ãŸã„æ—¥ï¼ˆç©ºæ¬„ãªã‚‰ä»Šæ—¥ï¼‰</label>
    <input id="targetDate" type="date">
  </div>

  <button onclick="calc()">ã“ã®æ—¥ã®é‹å‹¢ã‚’è¦‹ã‚‹</button>

  <p class="note">â€» æ•°å€¤ã¯å¤ªé™½ã€œåœŸæ˜Ÿã¾ã§ã®é…ç½®ã‚’ã‚‚ã¨ã«ã—ãŸã€Œä»Šæ—¥ã¨ã®ç›¸æ€§åº¦ã€ã§ã™ã€‚<br>â€» èª•ç”Ÿæ—¥ã¨å ã„ãŸã„æ—¥ãŒåŒã˜æœˆæ—¥ãªã‚‰ã€ã•ã•ã‚„ã‹ãªç´™å¹é›ªãŒèˆã„ã¾ã™ã€‚</p>

  <div id="result" class="result"></div>
</div>

<script>
// ---------- å®‰å®šä¹±æ•°ã¾ã‚ã‚Š ----------
function stableSeed(str) {
  let h = 1779033703 ^ str.length;
  for (let i = 0; i < str.length; i++) {
    h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
    h = (h << 13) | (h >>> 19);
  }
  h = (h ^ (h >>> 16)) >>> 0;
  return h;
}

function makeRng(seed) {
  let a = seed >>> 0;
  return function() {
    a |= 0;
    a = a + 0x6D2B79F5 | 0;
    let t = Math.imul(a ^ a >>> 15, 1 | a);
    t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t;
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  };
}

// ---------- ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ³ã‚¯ï¼ˆç°¡ç•¥ç‰ˆãƒ»ã‚°ãƒ¬ãƒ¼ãƒ‰åˆ¥ï¼‰ ----------
const TEXT_BANK = {
  total: {
    a: [
      "å°ã•ãªãã£ã‹ã‘ã‹ã‚‰ã€æµã‚Œã‚’æ•´ãˆç›´ã›ãã†ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚å®Œç’§ã§ã¯ãªãã¦ã‚‚ã€ä»Šã®è‡ªåˆ†ãªã‚Šã«æ•´ãˆã‚‹ã ã‘ã§ã€è¦–ç•ŒãŒã™ã£ã¨åºƒãŒã‚Šãã†ã§ã™ã€‚é ‘å¼µã‚Šã©ã“ã‚ã¨ä¼‘ã‚€ã¨ã“ã‚ã‚’åˆ†ã‘ã¦ã€â€œãŒã‚“ã°ã‚‰ãªã„æ™‚é–“â€ã‚’æ„è­˜çš„ã«ã¤ãã£ã¦ã¿ã¦ãã ã•ã„ã€‚",
      "å°ã•ãªãã£ã‹ã‘ã‹ã‚‰ã€æµã‚Œã‚’æ•´ãˆç›´ã›ãã†ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚å®Œç’§ã§ã¯ãªãã¦ã‚‚ã€ä»Šã®è‡ªåˆ†ãªã‚Šã«æ•´ãˆã‚‹ã ã‘ã§ã€è¦–ç•ŒãŒã™ã£ã¨åºƒãŒã‚Šãã†ã§ã™ã€‚äºˆå®šã®ã™ãé–“ã«ã€5åˆ†ã ã‘ã§ã‚‚å¥½ããªé£²ã¿ç‰©ã‚¿ã‚¤ãƒ ã‚’å…¥ã‚Œã¦ã€è‡ªåˆ†ã‚’ã­ãã‚‰ã£ã¦ã‚ã’ã¾ã—ã‚‡ã†ã€‚"
    ],
    b: [
      "å¿™ã—ã•ã®ä¸­ã«ã‚‚ã€å°ã•ãªæ¥½ã—ã¿ã‚„ä½™ç™½ã‚’è¦‹ã¤ã‘ã‚„ã™ã„æµã‚Œã«ãªã£ã¦ã„ã¾ã™ã€‚è‡ªåˆ†ã«å³ã—ããªã‚Šã™ãã¦ã„ãŸäººã¯ã€ä»Šæ—¥ã¯å°‘ã—æ¡ç‚¹ã‚’ç”˜ãã—ã¦ã‚ã’ã¾ã—ã‚‡ã†ã€‚",
      "å¿ƒã®ä¸­ã§å¼•ã£ã‹ã‹ã£ã¦ã„ãŸã“ã¨ã«ã€å°‘ã—å‰å‘ããªæ„å‘³ã¥ã‘ã‚’ã—ã‚„ã™ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ã€‚ã§ããŸã“ã¨ã«ç›®ã‚’å‘ã‘ã‚‹ã¨ã€è‡ªä¿¡ãŒã˜ã‚“ã‚ã‚Šã¨æˆ»ã£ã¦ãã¾ã™ã€‚"
    ],
    c: [
      "æ€ã£ãŸã‚ˆã†ã«é€²ã¾ãªã„ã“ã¨ãŒã‚ã£ã¦ã‚‚ã€å¤§ããè½ã¡è¾¼ã‚€å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚â€œä»Šæ—¥ã¯ãã†ã„ã†æ—¥â€ã¨ã‚†ã‚‹ãå—ã‘æ­¢ã‚ã¦ã€ã§ãã‚‹ç¯„å›²ã ã‘æ•´ãˆã¦ã„ãã¾ã—ã‚‡ã†ã€‚",
      "èª¿æ•´ã”ã¨ãŒå¢—ãˆã‚„ã™ã„æ—¥ã€‚ä½•ã‹ã‚’æ±ºã‚ã‚‹ã¨ãã¯ã€ä¸€åº¦æ·±å‘¼å¸ã—ã¦ã‹ã‚‰ã€‚è‡ªåˆ†ã‚’è²¬ã‚ã‚‹ã‚ˆã‚Šã€ã€Œä»Šã§ãã‚‹æœ€å–„ã€ã‚’é¸ã¶ã“ã¨ã‚’æ„è­˜ã—ã¦ã¿ã¦ãã ã•ã„ã€‚"
    ]
  },
  love: {
    a: [
      "æ‹æ„›ã«é™ã‚‰ãšã€äººã¨ã®ã¤ãªãŒã‚Šã‹ã‚‰ã‚ãŸãŸã‹ã•ã‚’æ„Ÿã˜ã‚„ã™ã„æ—¥ã€‚å¥½ãï¼è‹¦æ‰‹ã‚’ç„¡ç†ã«å¤‰ãˆã‚ˆã†ã¨ã›ãšã€è‡ªåˆ†ã®æ„Ÿè¦šã‚’å¤§åˆ‡ã«ã™ã‚‹ã»ã©ã€é–¢ä¿‚æ€§ãŒæ•´ã£ã¦ã„ãã¾ã™ã€‚ä¼šãˆãªã„æ™‚é–“ã¯ã€è‡ªåˆ†ç£¨ãã®æ™‚é–“ã ã¨æ€ã£ã¦ã€ãŠæ°—ã«å…¥ã‚Šã®æœã‚„é¦™ã‚Šã‚’è¦‹ç›´ã—ã¦ã¿ã‚‹ã®ã‚‚â—ã€‚",
      "æ‹æ„›ã«é™ã‚‰ãšã€äººã¨ã®ã¤ãªãŒã‚Šã‹ã‚‰ã‚ãŸãŸã‹ã•ã‚’æ„Ÿã˜ã‚„ã™ã„æ—¥ã€‚ã•ã•ã‚„ã‹ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚„ã‚¹ã‚¿ãƒ³ãƒ—ãŒã€æ€ã£ãŸä»¥ä¸Šã«å¿ƒã‚’è¿‘ã¥ã‘ã¦ãã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚"
    ],
    b: [
      "è¨€è‘‰ã®ã‚„ã‚Šå–ã‚Šã«ä¸€å–œä¸€æ†‚ã—ã‚„ã™ã„ã‹ã‚‰ã“ãã€è½ã¡ç€ã„ã¦å—ã‘æ­¢ã‚ãŸã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ã€‚éå»ã®å‡ºæ¥äº‹ã‚’æ€ã„å‡ºã—ã¦ã‚‚ã€ã€Œã‚ã®æ™‚ã®è‡ªåˆ†ã‚‚ã‚ˆããŒã‚“ã°ã£ã¦ã„ãŸã€ã¨èªã‚ã¦ã‚ã’ã¦ãã ã•ã„ã€‚",
      "è¨€è‘‰ã®ã‚„ã‚Šå–ã‚Šã«ä¸€å–œä¸€æ†‚ã—ã‚„ã™ã„ã‹ã‚‰ã“ãã€è½ã¡ç€ã„ã¦å—ã‘æ­¢ã‚ãŸã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ã€‚è¿”ä¿¡ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚ˆã‚Šã‚‚ã€ä¸€ã¤ä¸€ã¤ã®è¨€è‘‰ã®ã‚ãŸãŸã‹ã•ã‚’å¤§åˆ‡ã«ã™ã‚‹ã¨è‰¯ã•ãã†ã§ã™ã€‚"
    ],
    c: [
      "æ„Ÿæƒ…ãŒæºã‚Œã‚„ã™ã„æ—¥ã€‚ç›¸æ‰‹ã®åå¿œã‚’æ·±èª­ã¿ã—ã™ããšã€ã€Œä»Šã®è‡ªåˆ†ã¯ã©ã†æ„Ÿã˜ã¦ã„ã‚‹ã‹ã€ã‚’ä¸å¯§ã«è¨€è‘‰ã«ã—ã¦ã¿ã‚‹ã¨ã€æ°—æŒã¡ãŒå°‘ã—è½ã¡ç€ã„ã¦ãã¾ã™ã€‚",
      "æœŸå¾…ã¨ä¸å®‰ãŒå…¥ã‚Šæ··ã˜ã‚Šã‚„ã™ã„æ—¥ã€‚ç„¡ç†ã«ç­”ãˆã‚’å‡ºãã†ã¨ã›ãšã€â€œä»Šæ—¥ã¯ã“ã“ã¾ã§â€ã¨å¿ƒã«ãƒ©ã‚¤ãƒ³ã‚’å¼•ãã¨ã€æ¬¡ã®ä¸€æ­©ãŒè¦‹ãˆã‚„ã™ããªã‚Šã¾ã™ã€‚"
    ]
  },
  work: {
    a: [
      "ä¸€ã¤ã²ã¨ã¤ã®ä½œæ¥­ã«ã€ä¸å¯§ã•ã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã®ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Šã‚„ã™ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚å¾—æ„ãªã“ã¨ã¨è‹¦æ‰‹ãªã“ã¨ã‚’æŠŠæ¡ã—ã¦ã€å¾—æ„ãªéƒ¨åˆ†ã§å‘¨ã‚Šã‚’åŠ©ã‘ã‚‹ã¨ã€ä¿¡é ¼åº¦ãŒä¸ŠãŒã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ã€‚ä¸€åŒºåˆ‡ã‚Šã¤ããŸã³ã«ã€è‚©ã‚„é¦–ã‚’å›ã—ã¦ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã¨ã€é•·æ™‚é–“ã®ä½œæ¥­ã§ã‚‚ç–²ã‚ŒãŒæ®‹ã‚Šã«ãããªã‚Šã¾ã™ã€‚",
      "ä¸€ã¤ã²ã¨ã¤ã®ä½œæ¥­ã«ã€ä¸å¯§ã•ã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã®ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Šã‚„ã™ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚å‰ã‹ã‚‰æ°—ã«ãªã£ã¦ã„ãŸæ”¹å–„æ¡ˆã‚’ã€è»½ããƒ¡ãƒ¢ã«ã—ã¦å‘¨ã‚Šã«å…±æœ‰ã—ã¦ã¿ã‚‹ã¨ã€è©•ä¾¡ã«ã¤ãªãŒã‚‹ã‹ã‚‚ã€‚"
    ],
    b: [
      "ä»Šæ—¥ã¯ã€ŒãŒã‚“ã°ã‚Šç¶šã‘ã‚‹ã€ã‚ˆã‚Šã€Œé©åˆ‡ã«ä¼‘ã‚€ã€ã“ã¨ã‚’æ„è­˜ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚åŒã˜å§¿å‹¢ãŒç¶šãã¨ãã¯ã€è»½ã„ã‚¹ãƒˆãƒ¬ãƒƒãƒã§è¡€è¡Œã‚’è‰¯ãã—ã¦ã‚ã’ã¦ãã ã•ã„ã€‚",
      "ä»Šæ—¥ã¯ã€ŒãŒã‚“ã°ã‚Šç¶šã‘ã‚‹ã€ã‚ˆã‚Šã€Œé©åˆ‡ã«ä¼‘ã‚€ã€ã“ã¨ã‚’æ„è­˜ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä¸å®‰ã«æ„Ÿã˜ã¦ã„ã‚‹ã“ã¨ã¯ã€ãƒ¡ãƒ¢ã—ã¦ä¸Šå¸ã‚„åŒåƒšã«ç›¸è«‡ã™ã‚‹ãã£ã‹ã‘ã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚"
    ],
    c: [
      "é›†ä¸­åŠ›ãŒé€”åˆ‡ã‚Œã‚„ã™ã„æ—¥ã€‚å…¨éƒ¨ã‚’å®Œç’§ã«çµ‚ã‚ã‚‰ã›ã‚ˆã†ã¨ã›ãšã€ã€Œã“ã“ã¾ã§ã§ããŸã‚‰OKã€ã¨å°ã•ãªã‚´ãƒ¼ãƒ«ã‚’æ±ºã‚ã¦é€²ã‚ã‚‹ã¨ã€æ°—æŒã¡ãŒæ¥½ã«ãªã‚Šã¾ã™ã€‚",
      "åˆ¤æ–­ã«è¿·ã†ã“ã¨ãŒå‡ºã‚„ã™ã„æ—¥ã€‚å¤§äº‹ãªæ±ºæ–­ã¯ä¸€æ‹ãŠã„ã¦ã‹ã‚‰ã€‚ä»Šæ—¥ã¯æƒ…å ±ã‚’é›†ã‚ã‚‹æ—¥ã«ã—ã¦ã€çµè«–ã¯æ˜æ—¥ã«å›ã™ã®ã‚‚ä¸€ã¤ã®é¸æŠã§ã™ã€‚"
    ]
  },
  money: {
    a: [
      "ãŠé‡‘ã«å¯¾ã™ã‚‹ä¸å®‰ã‚’ã€å…·ä½“çš„ãªè¡Œå‹•ã«ã¤ãªã’ã‚„ã™ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ã€‚è¡å‹•è²·ã„ã‚’è²¬ã‚ã‚‹ã‚ˆã‚Šã€ã€Œãªãœæ¬²ã—ããªã£ãŸã®ã‹ã€ã‚’å„ªã—ãæŒ¯ã‚Šè¿”ã‚‹ã¨ã€æ¬¡ã®é¸æŠãŒæ¥½ã«ãªã‚Šã¾ã™ã€‚ä»Šæ—¥ã¯å¤§ããªè²·ã„ç‰©ã¯æ§ãˆã‚ã«ã—ã¦ã€æ¬²ã—ã„ã‚‚ã®ãƒªã‚¹ãƒˆã«â€œãƒ¡ãƒ¢ã ã‘ã™ã‚‹æ—¥â€ã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚",
      "ãŠé‡‘ã«é–¢ã™ã‚‹è¨ˆç”»ãŒç«‹ã¦ã‚„ã™ã„æ—¥ã€‚è²¯é‡‘ã‚„æ”¯å‡ºã®ç›®å®‰ã‚’ã–ã£ãã‚Šæ›¸ãå‡ºã—ã¦ã¿ã‚‹ã¨ã€å®‰å¿ƒæ„ŸãŒå¢—ã—ã¦ã„ãã¾ã™ã€‚"
    ],
    b: [
      "è¡å‹•è²·ã„ã—ãã†ã«ãªã£ãŸã‚‰ã€ãã®å ´ã§ä¸€åº¦ç«‹ã¡æ­¢ã¾ã‚Šã¾ã—ã‚‡ã†ã€‚ã™ã¹ã¦ã‚’ç´°ã‹ãç®¡ç†ã—ãªãã¦ã‚‚ã€ã€Œä½•ã¨ãªãã€ãŒæ¸›ã‚‹ã ã‘ã§å®‰å¿ƒæ„ŸãŒé•ã„ã¾ã™ã€‚",
      "ä»•äº‹å¸°ã‚Šã‚„ä¼‘æ—¥ã®ãŠå‡ºã‹ã‘å‰ã«ã€ä½¿ã£ã¦ã„ã„é‡‘é¡ã®ä¸Šé™ã‚’æ±ºã‚ã¦ãŠãã¾ã—ã‚‡ã†ã€‚ã€Œè²¯ã‚ã‚‹ãŸã‚ã«æˆ‘æ…¢ã™ã‚‹ã€ã‚ˆã‚Šã€Œå®‰å¿ƒã—ã¦æš®ã‚‰ã™ãŸã‚ã«æ•´ãˆã‚‹ã€ã¨è€ƒãˆã¦ã¿ã¦ãã ã•ã„ã€‚"
    ],
    c: [
      "ãŠé‡‘ã®ã“ã¨ã§ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã—ã‚„ã™ã„æ—¥ã€‚ã²ã¨ã‚Šã§æŠ±ãˆè¾¼ã¾ãšã€ä¿¡é ¼ã§ãã‚‹äººã«è»½ãç›¸è«‡ã—ã¦ã¿ã‚‹ã¨ã€æ„å¤–ãªãƒ’ãƒ³ãƒˆãŒã‚‚ã‚‰ãˆã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚",
      "ä»Šæ—¥ã¯å¤§ããªæ±ºæ–­ã¯æ§ãˆã‚ã«ã€‚æ”¯å‡ºã‚„å¥‘ç´„ã”ã¨ã¯ã€ã‚‚ã†ä¸€åº¦æ¡ä»¶ã‚’è¦‹ç›´ã—ã¦ã‹ã‚‰åˆ¤æ–­ã™ã‚‹ã¨å®‰å¿ƒã§ã™ã€‚"
    ]
  },
  health: {
    a: [
      "ä½“ã¨å¿ƒã®ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚’ã€ã‚„ã•ã—ãæ•´ãˆã‚„ã™ã„æ—¥ã€‚ç–²ã‚Œã¦ã„ã‚‹ã‚µã‚¤ãƒ³ã‚’ç„¡è¦–ã›ãšã€â€œä»Šæ—¥ã¯æ—©ãå¯ã‚‹æ—¥â€ã¨æ±ºã‚ã‚‹ã ã‘ã§ã‚‚ã€æ˜æ—¥ã®è‡ªåˆ†ãŒæ¥½ã«ãªã‚Šã¾ã™ã€‚",
      "ä½“ã¨å¿ƒã®ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚’ã€ã‚„ã•ã—ãæ•´ãˆã‚„ã™ã„æ—¥ã€‚ã„ã¤ã‚‚ã‚ˆã‚Šä¸€æ¯åˆ†å¤šãæ°´ã‚’é£²ã‚“ã§ã¿ã‚‹ã€éšæ®µã‚’ä¸€æ®µã ã‘å¤šãä¸ŠãŒã£ã¦ã¿ã‚‹ãªã©ã€å°ã•ãªå·¥å¤«ãŒæ˜æ—¥ã«ã¤ãªãŒã‚Šã¾ã™ã€‚"
    ],
    b: [
      "å¤œã¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚’è¦‹ã‚‹æ™‚é–“ã‚’å°‘ã—ã ã‘æ¸›ã‚‰ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚æ°´åˆ†è£œçµ¦ãŒãã¡ã‚“ã¨ã§ãã‚‹ã ã‘ã§ã‚‚ã€ã ã‚‹ã•ãŒå’Œã‚‰ãã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚",
      "å¤œã¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚’è¦‹ã‚‹æ™‚é–“ã‚’å°‘ã—ã ã‘æ¸›ã‚‰ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚æ·±å‘¼å¸ã‚’æ•°å›ç¹°ã‚Šè¿”ã—ã€è‡ªåˆ†ã®ä½“ã®çŠ¶æ…‹ã‚’é™ã‹ã«è¦³å¯Ÿã—ã¦ã¿ã¦ãã ã•ã„ã€‚"
    ],
    c: [
      "ç–²ã‚ŒãŒãŸã¾ã‚Šã‚„ã™ã„æ—¥ã€‚ç„¡ç†ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è©°ã‚è¾¼ã‚€ã‚ˆã‚Šã€â€œä»Šæ—¥ã¯ã“ã“ã¾ã§â€ã¨åŒºåˆ‡ã‚Šã‚’ã¤ã‘ã‚‹ã“ã¨ã‚’æ„è­˜ã—ã¦ã¿ã¦ãã ã•ã„ã€‚",
      "æ°—åœ§ã‚„æ°—æ¸©ã®å¤‰åŒ–ã§ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ãŒæºã‚Œã‚„ã™ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚æ¸©ã‹ã„é£²ã¿ç‰©ã‚„ãŠæ°—ã«å…¥ã‚Šã®é¦™ã‚Šã§ã€è‡ªåˆ†ã‚’ã‚„ã•ã—ãåŒ…ã‚€æ™‚é–“ã‚’ã¤ãã£ã¦ã‚ã’ã¾ã—ã‚‡ã†ã€‚"
    ]
  }
};

function gradeFromScore(score) {
  if (score >= 80) return 'a';
  if (score >= 55) return 'b';
  return 'c';
}

function pickText(category, score, rng) {
  const g = gradeFromScore(score);
  const arr = TEXT_BANK[category][g] || TEXT_BANK[category].b;
  const idx = Math.floor(rng() * arr.length);
  return arr[idx];
}

// ---------- ã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£ ----------
function fireConfetti() {
  const canvas = document.getElementById('confettiCanvas');
  const ctx = canvas.getContext('2d');
  const w = canvas.width = window.innerWidth;
  const h = canvas.height = window.innerHeight;
  const COUNT = 180;
  const confs = [];
  for (let i = 0; i < COUNT; i++) {
    confs.push({
      x: Math.random() * w,
      y: Math.random() * -h,
      vy: 2 + Math.random() * 3,
      vx: (Math.random() - 0.5) * 1.5,
      size: 4 + Math.random() * 4,
      rot: Math.random() * Math.PI * 2,
      vr: (Math.random() - 0.5) * 0.2
    });
  }
  let start = performance.now();
  function loop(now) {
    const t = now - start;
    ctx.clearRect(0,0,w,h);
    confs.forEach(c => {
      c.y += c.vy;
      c.x += c.vx;
      c.rot += c.vr;
      if (c.y > h + 20) {
        c.y = -20;
        c.x = Math.random() * w;
      }
      ctx.save();
      ctx.translate(c.x, c.y);
      ctx.rotate(c.rot);
      ctx.fillStyle = 'hsla(' + (260 + Math.random()*40) + ',70%,70%,0.9)';
      ctx.fillRect(-c.size/2, -c.size/2, c.size, c.size);
      ctx.restore();
    });
    if (t < 2500) {
      requestAnimationFrame(loop);
    } else {
      ctx.clearRect(0,0,w,h);
    }
  }
  requestAnimationFrame(loop);
}

// ---------- ãƒ¡ã‚¤ãƒ³è¨ˆç®— ----------
function calc() {
  const birthStr  = document.getElementById('birth').value;
  const targetStr = document.getElementById('targetDate').value;

  if (!birthStr) {
    alert('ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }
  if (typeof Astronomy === 'undefined') {
    alert('è¨ˆç®—ã‚¨ãƒ³ã‚¸ãƒ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å°‘ã—å¾…ã£ã¦ã‹ã‚‰å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
    return;
  }

  const [by, bm, bd] = birthStr.split('-').map(x => parseInt(x, 10));
  if (!by || !bm || !bd) {
    alert('ç”Ÿå¹´æœˆæ—¥ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
    return;
  }

  let now = new Date();
  if (targetStr) {
    const [ty, tm, td] = targetStr.split('-').map(x => parseInt(x, 10));
    if (!ty || !tm || !td) {
      alert('å ã„ãŸã„æ—¥ä»˜ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
      return;
    }
    now = new Date(ty, tm - 1, td, 12, 0, 0);
  } else {
    now = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 12, 0, 0);
  }

  const birthDate = new Date(by, bm - 1, bd, 12, 0, 0);

  const planets = [
    Astronomy.Body.Sun,
    Astronomy.Body.Moon,
    Astronomy.Body.Mercury,
    Astronomy.Body.Venus,
    Astronomy.Body.Mars,
    Astronomy.Body.Jupiter,
    Astronomy.Body.Saturn
  ];

  function eclLon(body, date) {
    const time = new Astronomy.AstroTime(date);
    const vec = Astronomy.GeoVector(body, time, true);
    const ecl = Astronomy.Ecliptic(vec);
    return ecl.elon;
  }

  function normalize(angle) {
    let a = angle % 360;
    if (a < 0) a += 360;
    return a;
  }

  function aspScore(diff) {
    const aspects = [0, 60, 90, 120, 180];
    const orb = 6;
    let best = 0;
    for (const a of aspects) {
      let d = Math.abs(diff - a);
      if (d > 180) d = 360 - d;
      if (d <= orb) {
        const s = 1 - (d / orb);
        if (s > best) best = s;
      }
    }
    return best * 2 - 1;
  }

  const nat = {};
  const tod = {};
  for (const p of planets) {
    nat[p] = eclLon(p, birthDate);
    tod[p] = eclLon(p, now);
  }

  let rawTotal = 0;
  for (let i = 0; i < planets.length; i++) {
    rawTotal += aspScore(normalize(tod[planets[i]] - nat[planets[i]]));
  }
  const rawLove   = aspScore(normalize(tod[Astronomy.Body.Venus]   - nat[Astronomy.Body.Venus]));
  const rawMoney  = aspScore(normalize(tod[Astronomy.Body.Jupiter] - nat[Astronomy.Body.Jupiter]));
  const rawWork   = aspScore(normalize(tod[Astronomy.Body.Mars]    - nat[Astronomy.Body.Mars])) +
                    aspScore(normalize(tod[Astronomy.Body.Saturn]  - nat[Astronomy.Body.Saturn]));
  const rawHealth = aspScore(normalize(tod[Astronomy.Body.Sun]     - nat[Astronomy.Body.Sun])) +
                    aspScore(normalize(tod[Astronomy.Body.Moon]    - nat[Astronomy.Body.Moon]));

  function clampNorm(x) {
    if (x < -1) return -1;
    if (x >  1) return 1;
    return x;
  }
  const nTotal  = clampNorm(rawTotal / (7 * 1));
  const nLove   = clampNorm(rawLove   / 1);
  const nMoney  = clampNorm(rawMoney  / 1);
  const nWork   = clampNorm(rawWork   / 2);
  const nHealth = clampNorm(rawHealth / 2);

  function clamp01to100(x) {
    if (x < 0) return 0;
    if (x > 100) return 100;
    return Math.round(x);
  }

  function scoreFromRandom(label, normBias, baseSpread, astroWeight) {
    const seed = label + '|' + birthStr + '|' + (targetStr || (now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate()));
    const rng  = makeRng(stableSeed(seed));
    const r    = rng();
    const base = 50 + (r - 0.5) * 100 * baseSpread;
    const astroShift = normBias * 25 * astroWeight;
    const val = base + astroShift;
    return clamp01to100(val);
  }

  const total = scoreFromRandom('total',  nTotal,  1.0, 0.9);
  let love    = scoreFromRandom('love',   nLove,   1.0, 0.7);
  let money   = scoreFromRandom('money',  nMoney,  1.0, 0.8);
  let work    = scoreFromRandom('work',   nWork,   1.0, 0.8);
  let health  = scoreFromRandom('health', nHealth, 1.0, 0.8);

  const seedBase = birthStr + '|' + (targetStr || (now.getFullYear() + '-' + (now.getMonth() + 1) + '-' + now.getDate()));

  const jitterRng = makeRng(stableSeed('jitter|' + seedBase));
  function jitterScore(base) {
    const amp = 6;
    const r = jitterRng();
    let v = base + (r * 2 - 1) * amp;
    if (v < 0) v = 0;
    if (v > 100) v = 100;
    return Math.round(v);
  }

  love   = jitterScore(love);
  money  = jitterScore(money);
  work   = jitterScore(work);
  health = jitterScore(health);

  const rngText = makeRng(stableSeed('text|' + seedBase));

  function fmt(n) {
    return Math.round(n) + '%';
  }

  const totalGrade = gradeFromScore(total);
  let totalLead = "";
  if (totalGrade === 'a') {
    totalLead = "ä»Šæ—¥ã¯è¿½ã„é¢¨ã‚’æ„Ÿã˜ã‚„ã™ã„æ—¥ã€‚å°‘ã—ã ã‘è¡Œå‹•ç¯„å›²ã‚’åºƒã’ã¦ã¿ã‚‹ã¨ã€ã†ã‚Œã—ã„å±•é–‹ã«ã¤ãªãŒã‚Šãã†ã§ã™ã€‚";
  } else if (totalGrade === 'b') {
    totalLead = "ç©ã‚„ã‹ãªæµã‚Œã®ä¸­ã§ã€æ—¥å¸¸ã‚’æ•´ãˆã‚„ã™ã„æ—¥ã€‚ç„¡ç†ãªãç¶šã‘ã‚‰ã‚Œã‚‹ãƒšãƒ¼ã‚¹ã‚’è¦‹ã¤ã‘ã¦ã¿ã¦ãã ã•ã„ã€‚";
  } else {
    totalLead = "å°‘ã—æ…é‡ã•ãŒå½¹ç«‹ã¤æ—¥ã€‚å¤§äº‹ãªã“ã¨ã»ã©ã€ã‚‚ã†ä¸€å‘¼å¸ãŠã„ã¦ã‹ã‚‰æ±ºã‚ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã„ãã¾ã—ã‚‡ã†ã€‚";
  }

  const totalText = pickText('total', total, rngText);
  const loveText  = pickText('love',  love,  rngText);
  const workText  = pickText('work',  work,  rngText);
  const moneyText = pickText('money', money, rngText);
  const healthText= pickText('health',health,rngText);

  let html = "";
  html += `<div class="section-title"><span class="icon">ğŸª</span><span>ä»Šæ—¥ã®ç·åˆé‹ ${fmt(total)}</span></div>`;
  html += `<div class="text-block">${totalLead}</div>`;
  html += `<div class="text-block">${totalText}</div>`;

  html += `<div class="section-title"><span class="icon">ğŸ’</span><span>æ‹æ„› ${fmt(love)}</span></div>`;
  html += `<div class="text-block">${loveText}</div>`;

  html += `<div class="section-title"><span class="icon">ğŸ’¼</span><span>ä»•äº‹ ${fmt(work)}</span></div>`;
  html += `<div class="text-block">${workText}</div>`;

  html += `<div class="section-title"><span class="icon">ğŸ’°</span><span>é‡‘é‹ ${fmt(money)}</span></div>`;
  html += `<div class="text-block">${moneyText}</div>`;

  html += `<div class="section-title"><span class="icon">ğŸ’—</span><span>å¥åº· ${fmt(health)}</span></div>`;
  html += `<div class="text-block">${healthText}</div>`;

  document.getElementById('result').innerHTML = html;

  if (targetStr) {
    const [ty, tm, td] = targetStr.split('-').map(x => parseInt(x, 10));
    if (tm === bm && td === bd) {
      fireConfetti();
    }
  } else {
    const today = new Date();
    if ((today.getMonth() + 1) === bm && today.getDate() === bd) {
      fireConfetti();
    }
  }
}
</script>
</body>
</html>
