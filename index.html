<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ä»Šæ—¥ã®é‹å‹¢ â€“ 100%</title>
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#B79DF2" />
<link rel="apple-touch-icon" href="icon-180.png" />
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Noto Sans JP",sans-serif;background:#fff;color:#333;margin:0;padding:20px;text-align:center;}
h1{color:#B79DF2;font-size:26px;margin-bottom:20px;}
.input-block{margin:16px 0;}
input,select,button{padding:12px;width:90%;max-width:360px;border-radius:8px;border:1px solid #ddd;margin:6px 0;font-size:16px;}
button{background:#B79DF2;color:#fff;border:none;font-weight:bold;cursor:pointer;transition:.25s;}
button:hover{filter:brightness(1.1);}
.score{font-size:44px;color:#B79DF2;margin-top:24px;margin-bottom:12px;font-weight:700;}
.card{background:#F7F4FF;border-radius:10px;padding:16px;max-width:360px;margin:12px auto;text-align:left;}
.label{font-weight:bold;color:#B79DF2;margin-bottom:6px;}
</style>
<script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.0/astronomy.browser.min.js"></script>
</head>
<body>
<h1>ğŸª ä»Šæ—¥ã®é‹å‹¢</h1>
<div class="input-block"><input type="date" id="birth" /></div>
<div class="input-block">
<select id="place">
<option value="35.6895,139.6917">æ±äº¬</option>
<option value="34.6937,135.5023">å¤§é˜ª</option>
<option value="35.0116,135.7681">äº¬éƒ½</option>
<option value="43.0621,141.3544">æœ­å¹Œ</option>
<option value="33.5902,130.4017">ç¦å²¡</option>
</select>
</div>
<button onclick="runToday()">ä»Šæ—¥ã®é‹å‹¢ã‚’è¦‹ã‚‹</button>
<div id="result"></div>
<script>
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => navigator.serviceWorker.register('sw.js'));
}
function toDeg(rad){return rad*180/Math.PI;}
function aspectScore(d){d=Math.abs(d);if(d<3)return 25;if(d<6)return 18;if(d<12)return 10;if(d<25)return 0;if(d<35)return -8;if(d<50)return -18;return -25;}
function normalize(d){return((d%360)+360)%360;}
const P=[Astronomy.Body.Sun,Astronomy.Body.Moon,Astronomy.Body.Mercury,Astronomy.Body.Venus,Astronomy.Body.Mars,Astronomy.Body.Jupiter,Astronomy.Body.Saturn];
function runToday(){
    const b=document.getElementById('birth').value;
    if(!b){alert("ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");return;}
    const [lat,lon]=document.getElementById('place').value.split(',').map(Number);
    const bd=new Date(b+"T12:00:00"); const now=new Date();
    const nat={}; const tod={};
    for(const p of P){nat[p]=normalize(Astronomy.Ecliptic(Astronomy.GeoVector(p,bd,true)).elon);}
    for(const p of P){tod[p]=normalize(Astronomy.Ecliptic(Astronomy.GeoVector(p,now,true)).elon);}
    let s=50; for(const p of P){s+=aspectScore(normalize(tod[p]-nat[p]));}
    s=Math.max(0,Math.min(100,Math.round(s)));
    const love=Math.round((s+aspectScore(normalize(tod[Astronomy.Body.Venus]-nat[Astronomy.Body.Venus])))/2);
    const money=Math.round((s+aspectScore(normalize(tod[Astronomy.Body.Jupiter]-nat[Astronomy.Body.Jupiter])))/2);
    const work=Math.round((s+aspectScore(normalize(tod[Astronomy.Body.Mars]-nat[Astronomy.Body.Mars])))/2);
    function msg(v){if(v>=80)return"ä»Šæ—¥ã¯ã­ã€ã¡ã‚‡ã£ã¨é‹ãŒå‘³æ–¹ã—ã¦ã‚‹ã‚ˆã€‚æ°—æ¥½ã«ã„ã“ï¼";if(v>=60)return"ã„ã„æ„Ÿã˜ã€‚è‡ªç„¶ä½“ã§å¤§ä¸ˆå¤«ã ã‚ˆã€‚";if(v>=40)return"ã‚†ã£ãã‚Šã€è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§ã­ã€‚";if(v>=20)return"å°‘ã—æ³¢ãŒã‚ã‚‹æ—¥ã€‚å„ªã—ãéã”ãï¼Ÿ";return"ä»Šæ—¥ã¯è‡ªåˆ†ã‚’å¤§äº‹ã«ã€‚ç„¡ç†ã—ãªã„ã§ã­ã€‚";}
    document.getElementById('result').innerHTML=
    `<div class="score">${s}%</div>
    <div class="card"><div class="label">ğŸ’ æ‹æ„›</div><div>${msg(love)}</div></div>
    <div class="card"><div class="label">ğŸ’° ãŠé‡‘</div><div>${msg(money)}</div></div>
    <div class="card"><div class="label">ğŸ’¼ ä»•äº‹</div><div>${msg(work)}</div></div>`;
    localStorage.birth=b; localStorage.place=document.getElementById('place').value;
}
window.onload=()=>{if(localStorage.birth)document.getElementById('birth').value=localStorage.birth;
if(localStorage.place)document.getElementById('place').value=localStorage.place;}
</script>
</body>
</html>
